<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¼è­·å£« Notebook - åˆ¤ä¾‹ãƒ»è«–ç‚¹æ•´ç†ãƒ„ãƒ¼ãƒ«</title>
    <!-- Google Fonts: Noto Sans JP -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Tailwind CSS (via CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        navy: {
                            50: '#f0f4f8',
                            100: '#d9e2ec',
                            700: '#1a365d', // Primary Navy
                            800: '#152c4e',
                            900: '#0f203c',
                        },
                        legal: {
                            gray: '#f8fafc',
                            border: '#e2e8f0',
                        }
                    },
                    fontFamily: {
                        sans: ['"Noto Sans JP"', 'sans-serif'],
                    },
                    animation: {
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>
    <style>
        textarea::-webkit-scrollbar { width: 8px; }
        textarea::-webkit-scrollbar-track { background: #f1f5f9; }
        textarea::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        textarea::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        textarea { transition: border-color 0.2s, box-shadow 0.2s; }
        
        select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
            -webkit-appearance: none;
            appearance: none;
        }

        /* Details/Summary animation enhancement */
        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }
        details[open] summary ~ * { animation: sweep .3s ease-in-out; }
        @keyframes sweep {
            0%    {opacity: 0; transform: translateY(-10px)}
            100%  {opacity: 1; transform: translateY(0)}
        }

        .recording-active {
            color: #ef4444 !important;
            border-color: #ef4444 !important;
            background-color: #fee2e2 !important;
        }
    </style>
</head>
<body class="bg-navy-50 text-slate-700 font-sans min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-navy-700 text-white py-4 shadow-md sticky top-0 z-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-slate-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" />
                </svg>
                <div>
                    <!-- Name Updated -->
                    <h1 class="text-lg font-bold tracking-wide">å¼è­·å£« Notebook</h1>
                    <p class="text-xs text-slate-300 font-normal">æ¥­å‹™åŠ¹ç‡åŒ–ãƒ»æ€è€ƒæ•´ç†ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ </p>
                </div>
            </div>
            <button id="clearAllBtn" class="text-xs text-slate-300 hover:text-white transition underline decoration-dotted flex items-center gap-1">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
                å…¨ã¦ã‚¯ãƒªã‚¢
            </button>
        </div>
    </header>

    <!-- Usage Guide -->
    <div class="bg-white border-b border-legal-border">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <details class="group py-2">
                <summary class="flex items-center cursor-pointer text-sm text-navy-700 font-medium hover:text-navy-800 focus:outline-none py-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-indigo-500 group-open:rotate-90 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                    </svg>
                    åˆã‚ã¦ã®æ–¹ã¸ï¼šã“ã®ã‚¢ãƒ—ãƒªã®ç›®çš„ãƒ»ä½¿ã„æ–¹
                </summary>
                <div class="pb-4 pl-9 pr-4 text-sm text-slate-600 space-y-3 border-t border-slate-100 mt-2 pt-3">
                    <div>
                        <h3 class="font-bold text-navy-800 mb-1">ğŸ“Œ ã‚¢ãƒ—ãƒªã®ç›®çš„</h3>
                        <p class="text-xs leading-relaxed">
                            æ³•å‹™ç›¸è«‡ã®å†…å®¹ã€èª¿æŸ»ã—ãŸåˆ¤ä¾‹ã€ä»Šå¾Œã®å¯¾å¿œæ–¹é‡ã‚’1ç”»é¢ã§æ•´ç†ã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚<br>
                            ã€Œæƒ…å ±ã‚’é›†ã‚ã‚‹ã ã‘ã€ã§çµ‚ã‚ã‚‰ã›ãšã€äº‹æ¡ˆã®å…¨ä½“åƒã‚’ä¿¯ç°ã—ã€æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆæ›¸é¢ä½œæˆãƒ»äº¤æ¸‰ãƒ»å¤–éƒ¨ãƒ„ãƒ¼ãƒ«æ´»ç”¨ï¼‰ã«ã¤ãªã’ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã€‚
                        </p>
                    </div>
                    <div>
                        <h3 class="font-bold text-navy-800 mb-1">ğŸ› ï¸ åŸºæœ¬çš„ãªä½¿ã„æ–¹</h3>
                        <ul class="list-disc list-inside text-xs leading-relaxed space-y-1">
                            <li><strong>Step 1 å…¥åŠ›ï¼š</strong> 3ã¤ã®ã‚«ãƒ©ãƒ ï¼ˆç›¸è«‡ãƒ»åˆ¤ä¾‹ãƒ»æ–¹é‡ï¼‰ã«å…¥åŠ›ã—ã¾ã™ã€‚éŸ³å£°å…¥åŠ›ã‚„PDFã®æ·»ä»˜ã‚‚å¯èƒ½ã§ã™ã€‚</li>
                            <li><strong>Step 2 æ•´ç†ï¼š</strong> æ¨ªä¸¦ã³ã®æƒ…å ±ã‚’ä¿¯ç°ã—ãªãŒã‚‰ã€è«–ç‚¹ã‚„è¨¼æ‹ ã®æ•´åˆæ€§ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚</li>
                            <li><strong>Step 3 å‡ºåŠ›ï¼š</strong> ç”»é¢ä¸‹ã®ã€Œæ•´ç†å†…å®¹ã‚’çµ±åˆå‡ºåŠ›ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€å„é …ç›®ã®å†…å®¹ãŒ1ã¤ã®ãƒ†ã‚­ã‚¹ãƒˆã«æ•´å½¢ã•ã‚Œã¾ã™ã€‚</li>
                        </ul>
                    </div>
                </div>
            </details>
        </div>
    </div>

    <!-- Main Content -->
    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">
        
        <!-- Grid Layout: 3 Columns -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 h-full">

            <!-- Column 1: Consultation & Issues -->
            <section class="flex flex-col h-full bg-white rounded-lg shadow-sm border border-legal-border overflow-hidden">
                <div class="p-4 border-b border-legal-border bg-slate-50 flex flex-col space-y-3">
                    <div class="flex items-center space-x-2">
                        <span class="bg-navy-700 text-white text-xs font-bold px-2 py-1 rounded">1</span>
                        <h2 class="font-bold text-navy-800">ç›¸è«‡å†…å®¹ãƒ»è«–ç‚¹ãƒ¡ãƒ¢</h2>
                    </div>
                    <!-- Template Selector -->
                    <select onchange="insertTemplate('consultation', this.value); this.value='';" class="w-full text-xs border-slate-300 rounded border bg-white py-1.5 px-3 text-slate-600 focus:border-navy-700 focus:outline-none cursor-pointer hover:bg-slate-50 transition">
                        <option value="" disabled selected>â–¼ ã‚ˆãã‚ã‚‹ç›¸è«‡é››å½¢ã‚’æŒ¿å…¥</option>
                        <option value="debt">1. å‚µæ¨©å›åï¼ˆè²¸é‡‘ãƒ»å£²æ›é‡‘ï¼‰</option>
                        <option value="divorce">2. é›¢å©šãƒ»ç”·å¥³å•é¡Œ</option>
                        <option value="realestate">3. ä¸å‹•ç”£ï¼ˆè³ƒè²¸ãƒ»æ˜æ¸¡ã—ï¼‰</option>
                        <option value="labor">4. åŠ´åƒï¼ˆè§£é›‡ãƒ»æ®‹æ¥­ä»£ï¼‰</option>
                        <option value="inheritance">5. ç›¸ç¶šãƒ»éºè¨€</option>
                    </select>
                </div>
                <div class="flex-grow flex flex-col p-0 relative group">
                    <textarea id="consultation" 
                        class="w-full h-96 md:h-[60vh] p-4 text-sm leading-relaxed text-slate-800 outline-none resize-none placeholder-slate-400 pb-20"
                        placeholder="ãƒ»ç›¸è«‡ã®æ¦‚è¦&#13;&#10;ãƒ»äº‰ç‚¹ã«ãªã‚Šãã†ãªãƒã‚¤ãƒ³ãƒˆ&#13;&#10;ãƒ»æ°—ã«ãªã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰..."></textarea>
                    
                    <!-- File List Container -->
                    <div id="file-list-consultation" class="absolute bottom-4 left-4 right-20 flex flex-wrap gap-2 pointer-events-none">
                        <!-- Attached files will appear here -->
                    </div>

                    <!-- Tools Wrapper -->
                    <div class="absolute bottom-4 right-4 flex space-x-2 opacity-0 group-hover:opacity-100 focus-within:opacity-100 transition z-10">
                        <!-- Attach File Button -->
                        <button onclick="triggerFileSelect('consultation')" class="bg-white border border-slate-200 shadow-sm p-2 rounded-full text-slate-500 hover:text-navy-700 hover:border-navy-700 transition" title="PDF/ç”»åƒæ·»ä»˜">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13" />
                            </svg>
                        </button>
                        <input type="file" id="file-input-consultation" class="hidden" accept=".pdf,image/*" onchange="handleFileSelect(this, 'consultation')">

                        <!-- Mic Button -->
                        <button onclick="toggleSpeech('consultation', this)" class="bg-white border border-slate-200 shadow-sm p-2 rounded-full text-slate-500 hover:text-navy-700 hover:border-navy-700 transition" title="éŸ³å£°å…¥åŠ›">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
                            </svg>
                        </button>
                        <!-- Copy Button -->
                        <button onclick="copyText('consultation', this)" class="bg-white border border-slate-200 shadow-sm p-2 rounded-full text-slate-500 hover:text-navy-700 hover:border-navy-700 transition" title="ã‚³ãƒ”ãƒ¼">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                            </svg>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Column 2: Precedents & References -->
            <section class="flex flex-col h-full bg-white rounded-lg shadow-sm border border-legal-border overflow-hidden">
                <div class="p-4 border-b border-legal-border bg-slate-50 flex flex-col space-y-3">
                    <div class="flex items-center space-x-2">
                        <span class="bg-navy-700 text-white text-xs font-bold px-2 py-1 rounded">2</span>
                        <h2 class="font-bold text-navy-800">é–¢é€£åˆ¤ä¾‹ãƒ»å‚è€ƒæƒ…å ±</h2>
                    </div>
                    <!-- Template Selector -->
                    <select onchange="insertTemplate('precedents', this.value); this.value='';" class="w-full text-xs border-slate-300 rounded border bg-white py-1.5 px-3 text-slate-600 focus:border-navy-700 focus:outline-none cursor-pointer hover:bg-slate-50 transition">
                        <option value="" disabled selected>â–¼ èª¿æŸ»ãƒ»æ¤œè¨ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’æŒ¿å…¥</option>
                        <option value="requirements">1. è¦ä»¶äº‹å®Ÿã®æ•´ç†</option>
                        <option value="keywords">2. é¡ä¼¼åˆ¤ä¾‹æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰</option>
                        <option value="timeline">3. æ™‚åŠ¹ãƒ»æœŸé–“åˆ¶é™ãƒã‚§ãƒƒã‚¯</option>
                        <option value="evidence">4. è¨¼æ‹ ä¸€è¦§ï¼ˆæ›¸è¨¼ãƒ»äººè¨¼ï¼‰</option>
                        <option value="risk">5. ãƒªã‚¹ã‚¯ãƒ»äº‰ç‚¹æ•´ç†</option>
                    </select>
                </div>
                <div class="flex-grow flex flex-col p-0 relative group">
                    <textarea id="precedents" 
                        class="w-full h-96 md:h-[60vh] p-4 text-sm leading-relaxed text-slate-800 outline-none resize-none placeholder-slate-400 pb-20"
                        placeholder="ãƒ»åˆ¤ä¾‹ã®è¦æ—¨&#13;&#10;ãƒ»è£åˆ¤æ‰€åï¼å¹´æœˆæ—¥&#13;&#10;ãƒ»ãƒã‚¤ãƒ³ãƒˆã«ãªã£ãŸåˆ¤æ–­ç†ç”±..."></textarea>
                    
                    <!-- File List Container -->
                    <div id="file-list-precedents" class="absolute bottom-4 left-4 right-20 flex flex-wrap gap-2 pointer-events-none"></div>

                    <!-- Tools Wrapper -->
                    <div class="absolute bottom-4 right-4 flex space-x-2 opacity-0 group-hover:opacity-100 focus-within:opacity-100 transition z-10">
                        <!-- Attach File Button -->
                        <button onclick="triggerFileSelect('precedents')" class="bg-white border border-slate-200 shadow-sm p-2 rounded-full text-slate-500 hover:text-navy-700 hover:border-navy-700 transition" title="PDF/ç”»åƒæ·»ä»˜">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13" />
                            </svg>
                        </button>
                        <input type="file" id="file-input-precedents" class="hidden" accept=".pdf,image/*" onchange="handleFileSelect(this, 'precedents')">

                        <!-- Mic Button -->
                        <button onclick="toggleSpeech('precedents', this)" class="bg-white border border-slate-200 shadow-sm p-2 rounded-full text-slate-500 hover:text-navy-700 hover:border-navy-700 transition" title="éŸ³å£°å…¥åŠ›">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
                            </svg>
                        </button>
                        <!-- Copy Button -->
                        <button onclick="copyText('precedents', this)" class="bg-white border border-slate-200 shadow-sm p-2 rounded-full text-slate-500 hover:text-navy-700 hover:border-navy-700 transition" title="ã‚³ãƒ”ãƒ¼">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                            </svg>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Column 3: Next Actions -->
            <section class="flex flex-col h-full bg-white rounded-lg shadow-sm border border-legal-border overflow-hidden">
                <div class="p-4 border-b border-legal-border bg-slate-50 flex flex-col space-y-3">
                    <div class="flex items-center space-x-2">
                        <span class="bg-navy-700 text-white text-xs font-bold px-2 py-1 rounded">3</span>
                        <h2 class="font-bold text-navy-800">æ¬¡ã®ææ¡ˆãƒ»å¯¾å¿œæ–¹é‡</h2>
                    </div>
                    <!-- Template Selector -->
                    <select onchange="insertTemplate('actions', this.value); this.value='';" class="w-full text-xs border-slate-300 rounded border bg-white py-1.5 px-3 text-slate-600 focus:border-navy-700 focus:outline-none cursor-pointer hover:bg-slate-50 transition">
                        <option value="" disabled selected>â–¼ å¯¾å¿œãƒ»ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ¡ˆã‚’æŒ¿å…¥</option>
                        <option value="notice">1. å†…å®¹è¨¼æ˜éƒµä¾¿ã®é€ä»˜</option>
                        <option value="negotiation">2. äº¤æ¸‰ãƒ»ç¤ºè«‡ã®ææ¡ˆ</option>
                        <option value="mediation">3. èª¿åœãƒ»ADRç”³ç«‹ã¦</option>
                        <option value="litigation">4. è¨´è¨Ÿæèµ·ãƒ»ä¿å…¨</option>
                        <option value="decline">5. å—ä»»è¦‹é€ã‚Šãƒ»ç¶™ç¶šç›¸è«‡</option>
                    </select>
                </div>
                <div class="flex-grow flex flex-col p-0 relative group">
                    <textarea id="actions" 
                        class="w-full h-96 md:h-[60vh] p-4 text-sm leading-relaxed text-slate-800 outline-none resize-none placeholder-slate-400 pb-20"
                        placeholder="ãƒ»ä¾é ¼è€…ã¸ã®èª¬æ˜æ–¹é‡&#13;&#10;ãƒ»è¿½åŠ ã§ç¢ºèªã™ã¹ãç‚¹&#13;&#10;ãƒ»è¦‹ç©ãƒ»å¥‘ç´„ãƒ»æ¬¡å›æ‰“åˆã›ã®æ–¹å‘æ€§..."></textarea>
                    
                    <!-- File List Container -->
                    <div id="file-list-actions" class="absolute bottom-4 left-4 right-20 flex flex-wrap gap-2 pointer-events-none"></div>

                    <!-- Tools Wrapper -->
                    <div class="absolute bottom-4 right-4 flex space-x-2 opacity-0 group-hover:opacity-100 focus-within:opacity-100 transition z-10">
                        <!-- Attach File Button -->
                        <button onclick="triggerFileSelect('actions')" class="bg-white border border-slate-200 shadow-sm p-2 rounded-full text-slate-500 hover:text-navy-700 hover:border-navy-700 transition" title="PDF/ç”»åƒæ·»ä»˜">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13" />
                            </svg>
                        </button>
                        <input type="file" id="file-input-actions" class="hidden" accept=".pdf,image/*" onchange="handleFileSelect(this, 'actions')">

                        <!-- Mic Button -->
                        <button onclick="toggleSpeech('actions', this)" class="bg-white border border-slate-200 shadow-sm p-2 rounded-full text-slate-500 hover:text-navy-700 hover:border-navy-700 transition" title="éŸ³å£°å…¥åŠ›">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
                            </svg>
                        </button>
                        <!-- Copy Button -->
                        <button onclick="copyText('actions', this)" class="bg-white border border-slate-200 shadow-sm p-2 rounded-full text-slate-500 hover:text-navy-700 hover:border-navy-700 transition" title="ã‚³ãƒ”ãƒ¼">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                            </svg>
                        </button>
                    </div>
                </div>
            </section>
        </div>

        <!-- Summary Output Section -->
        <div class="mt-8 bg-navy-50 border-t-2 border-slate-200 pt-8">
            <div class="flex flex-col items-center">
                <button onclick="generateSummary()" class="group bg-navy-700 hover:bg-navy-800 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-all transform hover:-translate-y-1 flex items-center space-x-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-indigo-200 group-hover:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <span>æ•´ç†å†…å®¹ã‚’çµ±åˆå‡ºåŠ›</span>
                </button>
                <p class="mt-2 text-xs text-slate-500">3ã‚«ãƒ©ãƒ ã®å†…å®¹ã‚’çµ±åˆãƒ»æ•´å½¢ã—ã€ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰è²¼ã‚Šä»˜ã‘ç”¨ã«ç”Ÿæˆã—ã¾ã™</p>
            </div>

            <!-- Output Area -->
            <div id="outputContainer" class="mt-6 max-w-4xl mx-auto hidden">
                <div class="bg-white rounded-lg shadow border border-indigo-100 overflow-hidden">
                    <div class="bg-indigo-50 px-4 py-2 border-b border-indigo-100 flex justify-between items-center">
                        <span class="text-xs font-bold text-navy-700">å‡ºåŠ›ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆã‚³ãƒ”ãƒ¼ç”¨ï¼‰</span>
                        <button onclick="copyText('summaryOutput', this)" class="text-xs text-indigo-600 hover:text-indigo-800 font-medium flex items-center space-x-1">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                            </svg>
                            <span>ã‚³ãƒ”ãƒ¼</span>
                        </button>
                    </div>
                    <textarea id="summaryOutput" class="w-full h-48 p-4 text-sm font-mono text-slate-700 bg-white outline-none resize-y" readonly></textarea>
                </div>
            </div>
        </div>

    </main>

    <footer class="bg-white border-t border-slate-200 py-6 mt-auto">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-xs text-slate-400 mb-2">
                æœ¬ãƒ„ãƒ¼ãƒ«ã¯ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§å‹•ä½œã—ã€å…¥åŠ›å†…å®¹ã¯ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚ãƒšãƒ¼ã‚¸ã‚’é–‰ã˜ã‚‹ã¨å†…å®¹ã¯ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚
            </p>
            <p class="text-[10px] text-slate-400">ãƒ†ã‚¹ãƒˆç‰ˆï¼ˆãƒ™ãƒ¼ã‚¿ç‰ˆï¼‰ Â© 2026 SPC</p>
        </div>
    </footer>

    <script>
        // --- Templates Definitions ---
        const TEMPLATES = {
            debt: "ã€ç›¸è«‡ç¨®åˆ¥ã€‘å‚µæ¨©å›å\nã€å‚µæ¨©ã®ç¨®é¡ã€‘å£²æ›é‡‘ãƒ»è²¸é‡‘\nã€å¥‘ç´„æ›¸ã®æœ‰ç„¡ã€‘ã‚ã‚Šãƒ»ãªã—\nã€ç›¸æ‰‹æ–¹ã®å¯¾å¿œã€‘éŸ³ä¿¡ä¸é€šãƒ»æ”¯æ‰•æ„æ€ã‚ã‚Šãƒ»è³‡åŠ›ä¸æ˜\nã€å¸Œæœ›ã™ã‚‹è§£æ±ºã€‘æ—©æœŸå›åãƒ»åˆ†å‰²æ‰•ã„ã§ã‚‚å¯ãƒ»å¼·ç¡¬æ‰‹æ®µè¾ã•ãš\n\nã€è©³ç´°ãªäº‹å®ŸçµŒç·¯ã€‘\n",
            divorce: "ã€ç›¸è«‡ç¨®åˆ¥ã€‘é›¢å©šãƒ»ç”·å¥³å•é¡Œ\nã€å½“äº‹è€…å±æ€§ã€‘å©šå§»å¹´æ•°â—‹å¹´ãƒ»å­â—‹äººï¼ˆâ—‹æ­³ï¼‰\nã€ä¸»ãªäº‰ç‚¹ã€‘è¦ªæ¨©ãƒ»é¤Šè‚²è²»ãƒ»è²¡ç”£åˆ†ä¸ãƒ»æ…°è¬æ–™ãƒ»å¹´é‡‘åˆ†å‰²\nã€ç›¸æ‰‹æ–¹ã®æ…‹åº¦ã€‘é›¢å©šæ‹’å¦ãƒ»æ¡ä»¶æ¬¡ç¬¬ãƒ»ãƒ¢ãƒ©ãƒãƒ©æ°—å‘³\nã€åˆ¥å±…ã®æœ‰ç„¡ã€‘åˆ¥å±…ä¸­ï¼ˆæœŸé–“â—‹ãƒ¶æœˆï¼‰\n\nã€è©³ç´°ãªç›¸è«‡å†…å®¹ã€‘\n",
            realestate: "ã€ç›¸è«‡ç¨®åˆ¥ã€‘ä¸å‹•ç”£ï¼ˆè³ƒè²¸ãƒ»æ˜æ¸¡ã—ï¼‰\nã€ç‰©ä»¶æ¦‚è¦ã€‘å±…ä½ç”¨ãƒ»äº‹æ¥­ç”¨ï¼ˆæœˆé¡è³ƒæ–™â—‹ä¸‡å††ï¼‰\nã€æ»ç´æœŸé–“ã€‘â—‹ãƒ¶æœˆåˆ†\nã€ä¿¡é ¼é–¢ä¿‚ç ´å£Šã€‘ç”¨æ³•éµå®ˆé•åãƒ»é¨’éŸ³ãƒ»ç„¡æ–­è»¢è²¸\nã€å¥‘ç´„è§£é™¤é€šçŸ¥ã€‘æœªé€ä»˜ãƒ»é€ä»˜æ¸ˆã¿\n\nã€è©³ç´°ãªäº‹å®Ÿé–¢ä¿‚ã€‘\n",
            labor: "ã€ç›¸è«‡ç¨®åˆ¥ã€‘åŠ´åƒãƒˆãƒ©ãƒ–ãƒ«\nã€ç«‹å ´ã€‘ä¼æ¥­å´ãƒ»åŠ´åƒè€…å´\nã€å•é¡Œã€‘ä¸å½“è§£é›‡ãƒ»æ®‹æ¥­ä»£æœªæ‰•ã„ãƒ»ãƒ‘ãƒ¯ãƒãƒ©ãƒ»æ‡²æˆ’å‡¦åˆ†\nã€å°±æ¥­è¦å‰‡ã€‘ã‚ã‚Šãƒ»ãªã—\nã€è¨¼æ‹ ã€‘ã‚¿ã‚¤ãƒ ã‚«ãƒ¼ãƒ‰ãƒ»ãƒ¡ãƒ¼ãƒ«ãƒ»éŒ²éŸ³\n\nã€è©³ç´°ãªçµŒç·¯ã€‘\n",
            inheritance: "ã€ç›¸è«‡ç¨®åˆ¥ã€‘ç›¸ç¶šãƒ»éºè¨€\nã€è¢«ç›¸ç¶šäººã€‘æ­»äº¡æ—¥ï¼šâ—‹å¹´â—‹æœˆâ—‹æ—¥\nã€ç›¸ç¶šäººã€‘é…å¶è€…ã€å­â—‹å\nã€éºç”£å†…å®¹ã€‘ä¸å‹•ç”£ã€é è²¯é‡‘ï¼ˆç´„â—‹ä¸‡å††ï¼‰ã€æ ªå¼\nã€éºè¨€æ›¸ã®æœ‰ç„¡ã€‘è‡ªç­†è¨¼æ›¸ãƒ»å…¬æ­£è¨¼æ›¸ãƒ»ãªã—\nã€äº‰ç‚¹ã€‘éºç”£åˆ†å‰²å”è­°ãƒ»å¯„ä¸åˆ†ãƒ»ç‰¹åˆ¥å—ç›Šãƒ»éºç•™åˆ†\n\nã€è©³ç´°ãªç›¸è«‡å†…å®¹ã€‘\n",
            requirements: "ã€è¦ä»¶äº‹å®Ÿã®æ•´ç†ã€‘\n1. è«‹æ±‚åŸå› äº‹å®Ÿï¼š\n   ãƒ»\n   ãƒ»\n2. æŠ—å¼äº‹å®Ÿï¼š\n   ãƒ»\n   ãƒ»\n3. å†æŠ—å¼ï¼š\n   ãƒ»\n",
            keywords: "ã€æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å€™è£œã€‘\nãƒ»ä¸»èªï¼š\nãƒ»è¡Œç‚ºï¼š\nãƒ»æ³•çš„è©•ä¾¡ï¼š\nãƒ»é¡ä¼¼åˆ¤ä¾‹ã®åˆ¤æ–­æ çµ„ã¿ï¼š\n",
            timeline: "ã€æ™‚åŠ¹ãƒ»æœŸé–“åˆ¶é™ãƒã‚§ãƒƒã‚¯ã€‘\nãƒ»æ¨©åˆ©è¡Œä½¿å¯èƒ½æ—¥ï¼š\nãƒ»æ¶ˆæ»…æ™‚åŠ¹å®Œæˆæ—¥ï¼š\nãƒ»é™¤æ–¥æœŸé–“ï¼š\nãƒ»æ™‚åŠ¹æ›´æ–°æªç½®ã®æœ‰ç„¡ï¼š\n",
            evidence: "ã€è¨¼æ‹ ä¸€è¦§ã€‘\n[æ›¸è¨¼]\nãƒ»ç”²1å·è¨¼ï¼š\nãƒ»ç”²2å·è¨¼ï¼š\n\n[äººè¨¼]\nãƒ»è¨¼äººï¼š\nãƒ»é™³è¿°æ›¸ï¼š\n",
            risk: "ã€ãƒªã‚¹ã‚¯ãƒ»äº‰ç‚¹æ•´ç†ã€‘\nãƒ»å½“æ–¹ã®å¼±ç‚¹ï¼š\nãƒ»ç›¸æ‰‹æ–¹ã®äºˆæƒ³ã•ã‚Œã‚‹åè«–ï¼š\nãƒ»èªå®¹ã•ã‚Œã‚‹å¯èƒ½æ€§ï¼ˆå‹è¨´è¦‹è¾¼ã¿ï¼‰ï¼šâ—‹ï¼…ç¨‹åº¦\nãƒ»ã‚³ã‚¹ãƒˆå€’ã‚Œã®ãƒªã‚¹ã‚¯ï¼š\n",
            notice: "ã€å¯¾å¿œæ–¹é‡ã€‘å†…å®¹è¨¼æ˜éƒµä¾¿ã®é€ä»˜\nãƒ»é€ä»˜æœŸé™ï¼š\nãƒ»é€šçŸ¥æ›¸ã®ä¸»æ—¨ï¼šå¥‘ç´„è§£é™¤ãƒ»æ”¯æ‰•å‚¬å‘Š\nãƒ»å›ç­”æœŸé™ã®è¨­å®šï¼šæœ¬æ›¸é¢åˆ°é”å¾Œâ—‹æ—¥ä»¥å†…\nãƒ»ç™ºé€å¾Œã®äºˆå®šï¼šå›ç­”ãŒãªã‘ã‚Œã°è¨´è¨Ÿæº–å‚™\n",
            negotiation: "ã€å¯¾å¿œæ–¹é‡ã€‘äº¤æ¸‰ãƒ»ç¤ºè«‡ææ¡ˆ\nãƒ»æç¤ºæ¡ä»¶ï¼š\nãƒ»è­²æ­©å¯èƒ½ãªãƒ©ã‚¤ãƒ³ï¼ˆãƒœãƒˆãƒ ãƒ©ã‚¤ãƒ³ï¼‰ï¼š\nãƒ»è§£æ±ºé‡‘ã®ç›®å®‰ï¼š\nãƒ»åˆæ„æ›¸æ¡ˆã®ä½œæˆè¦å¦ï¼š\n",
            mediation: "ã€å¯¾å¿œæ–¹é‡ã€‘èª¿åœãƒ»ADRç”³ç«‹ã¦\nãƒ»ç”³ç«‹å…ˆï¼šâ—‹ç°¡æ˜“è£åˆ¤æ‰€ãƒ»å¼è­·å£«ä¼šADR\nãƒ»ç”³ç«‹ã¦ã®è¶£æ—¨ï¼š\nãƒ»æƒ³å®šã•ã‚Œã‚‹æœŸé–“ï¼š\n",
            litigation: "ã€å¯¾å¿œæ–¹é‡ã€‘è¨´è¨Ÿæèµ·ãƒ»ä¿å…¨\nãƒ»ç®¡è½„è£åˆ¤æ‰€ï¼š\nãƒ»è¨´é¡ï¼š\nãƒ»å°ç´™ä»£äºˆç´éƒµåˆ¸ï¼š\nãƒ»ä»®å·®æŠ¼ãˆã®å¿…è¦æ€§ï¼šã‚ã‚Šï¼ˆå¯¾è±¡è²¡ç”£ï¼šï¼‰\n",
            decline: "ã€å¯¾å¿œæ–¹é‡ã€‘å—ä»»è¦‹é€ã‚Šãƒ»ç¶™ç¶šç›¸è«‡\nãƒ»ç†ç”±ï¼šå‹è¨´è¦‹è¾¼ã¿è–„ãƒ»è²»ç”¨å¯¾åŠ¹æœãƒ»åˆ©ç›Šç›¸å\nãƒ»ä¾é ¼è€…ã¸ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹ï¼š\nãƒ»æ³•ãƒ†ãƒ©ã‚¹ã®æ¡ˆå†…ï¼š\n"
        };

        function insertTemplate(targetId, templateKey) {
            if (!templateKey || !TEMPLATES[templateKey]) return;
            const textarea = document.getElementById(targetId);
            const templateText = TEMPLATES[templateKey];
            const startPos = textarea.selectionStart;
            const endPos = textarea.selectionEnd;
            const currentValue = textarea.value;
            const newValue = currentValue.substring(0, startPos) + templateText + currentValue.substring(endPos, currentValue.length);
            textarea.value = newValue;
            textarea.selectionStart = startPos + templateText.length;
            textarea.selectionEnd = startPos + templateText.length;
            textarea.focus();
        }

        // --- File Attachment Logic ---
        function triggerFileSelect(columnId) {
            document.getElementById(`file-input-${columnId}`).click();
        }

        function handleFileSelect(input, columnId) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                const fileUrl = URL.createObjectURL(file);
                
                // Create Chip Element
                const chip = document.createElement('div');
                chip.className = "bg-navy-100 text-navy-800 text-xs px-2 py-1 rounded-full flex items-center space-x-1 shadow-sm pointer-events-auto cursor-pointer hover:bg-navy-200 transition border border-navy-200";
                chip.onclick = () => window.open(fileUrl, '_blank');
                
                // Icon based on type
                let iconPath = "M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"; // Default file
                if (file.type.includes('image')) {
                    iconPath = "M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z";
                }

                chip.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${iconPath}" />
                    </svg>
                    <span class="max-w-[100px] truncate">${file.name}</span>
                `;
                
                document.getElementById(`file-list-${columnId}`).appendChild(chip);
                
                // Clear input to allow re-selecting same file
                input.value = '';
            }
        }

        // --- Speech Recognition Logic ---
        let recognition = null;
        let currentTargetId = null;

        function toggleSpeech(targetId, btnElement) {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                alert("ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°å…¥åŠ›ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚\nChrome, Edge, Safariç­‰ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚");
                return;
            }

            if (recognition && currentTargetId === targetId) {
                recognition.stop();
                return;
            }
            if (recognition) {
                recognition.stop();
            }

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.lang = 'ja-JP';
            recognition.interimResults = false;
            recognition.continuous = false; 

            currentTargetId = targetId;

            recognition.onstart = function() {
                btnElement.classList.add('recording-active', 'animate-pulse-fast');
                document.getElementById(targetId).placeholder = "èã„ã¦ã„ã¾ã™...";
            };

            recognition.onend = function() {
                resetMicUI(btnElement, targetId);
                recognition = null;
                currentTargetId = null;
            };

            recognition.onresult = function(event) {
                const result = event.results[0][0].transcript;
                const textarea = document.getElementById(targetId);
                if (textarea.value && !textarea.value.endsWith('\n')) {
                     textarea.value += '\n';
                }
                textarea.value += result;
            };

            recognition.onerror = function(event) {
                console.error("Speech error", event.error);
                resetMicUI(btnElement, targetId);
                if (event.error === 'not-allowed') {
                    alert("ãƒã‚¤ã‚¯ã®ä½¿ç”¨ãŒè¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚");
                }
            };

            recognition.start();
        }

        function resetMicUI(btn, targetId) {
            if(btn) btn.classList.remove('recording-active', 'animate-pulse-fast');
            // Restore simplified placeholders
            if (targetId === 'consultation') document.getElementById(targetId).placeholder = "ãƒ»ç›¸è«‡ã®æ¦‚è¦...";
            if (targetId === 'precedents') document.getElementById(targetId).placeholder = "ãƒ»åˆ¤ä¾‹ã®è¦æ—¨...";
            if (targetId === 'actions') document.getElementById(targetId).placeholder = "ãƒ»ä¾é ¼è€…ã¸ã®èª¬æ˜æ–¹é‡...";
        }

        // --- Copy & Generate Logic ---
        function copyText(elementId, btnElement) {
            const textarea = document.getElementById(elementId);
            textarea.select();
            textarea.setSelectionRange(0, 99999); 
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(textarea.value).then(() => showCopyFeedback(btnElement))
                .catch(() => fallbackCopyText(textarea, btnElement));
            } else {
                fallbackCopyText(textarea, btnElement);
            }
        }

        function fallbackCopyText(textarea, btnElement) {
            try {
                document.execCommand('copy');
                showCopyFeedback(btnElement);
            } catch (err) {
                alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
            }
        }

        function showCopyFeedback(btnElement) {
            const originalContent = btnElement.innerHTML;
            btnElement.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>`;
            setTimeout(() => btnElement.innerHTML = originalContent, 2000);
        }

        function generateSummary() {
            const consultation = document.getElementById('consultation').value.trim();
            const precedents = document.getElementById('precedents').value.trim();
            const actions = document.getElementById('actions').value.trim();
            
            const formattedText = `ã€æ¡ˆä»¶æ•´ç†ã‚µãƒãƒªãƒ¼ã€‘ä»¥ä¸‹ã®é€šã‚Šæƒ…å ±ã‚’æ•´ç†ã—ã¾ã—ãŸã€‚\n\nã€ç›¸è«‡å†…å®¹ãƒ»è«–ç‚¹ã€‘\n${consultation || "ï¼ˆç‰¹ã«ãªã—ï¼‰"}\n\nã€é–¢é€£åˆ¤ä¾‹ãƒ»å‚è€ƒæƒ…å ±ã€‘\n${precedents || "ï¼ˆç‰¹ã«ãªã—ï¼‰"}\n\nã€ç¾åœ¨è€ƒãˆã¦ã„ã‚‹æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ»å¯¾å¿œæ–¹é‡ã€‘\n${actions || "ï¼ˆç‰¹ã«ãªã—ï¼‰"}`;
            
            const outputContainer = document.getElementById('outputContainer');
            const outputTextarea = document.getElementById('summaryOutput');
            outputTextarea.value = formattedText;
            outputContainer.classList.remove('hidden');
            outputContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // --- Clear Functionality ---
        document.addEventListener('DOMContentLoaded', function() {
            const clearBtn = document.getElementById('clearAllBtn');
            if (clearBtn) {
                clearBtn.addEventListener('click', () => {
                    if(window.confirm("ã€è­¦å‘Šã€‘\nå…¥åŠ›ä¸­ã®å†…å®¹ã‚’ã™ã¹ã¦æ¶ˆå»ã—ã¾ã™ã‹ï¼Ÿ")) {
                        document.querySelectorAll('textarea').forEach(t => t.value = '');
                        document.querySelectorAll('select').forEach(s => s.selectedIndex = 0);
                        document.getElementById('outputContainer').classList.add('hidden');
                        // Clear attached files visualization
                        document.getElementById('file-list-consultation').innerHTML = '';
                        document.getElementById('file-list-precedents').innerHTML = '';
                        document.getElementById('file-list-actions').innerHTML = '';
                    }
                });
            }
        });
    </script>
</body>
</html>